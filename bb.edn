{:min-bb-version "1.3.190"

 :paths ["packages/forj-mcp/src"
         "packages/forj-hooks/src"
         "packages/clj-init/src"]

 :deps {}

 :tasks
 {:requires ([babashka.fs :as fs])

  dev
  {:doc "Start development environment"
   :task (println "forj dev environment - use bb mcp:dev to test MCP server")}

  test
  {:doc "Run all tests"
   :task (do
           (run 'test:mcp)
           (run 'test:hooks))}

  test:mcp
  {:doc "Test MCP server"
   :task (shell "bb" "-cp" "packages/forj-mcp/src:packages/forj-mcp/test"
                "-m" "forj.mcp.test-runner")}

  test:hooks
  {:doc "Test hooks"
   :task (println "Hook tests not yet implemented")}

  mcp:dev
  {:doc "Run MCP server in dev mode (for testing)"
   :task (shell "bb" "-cp" "packages/forj-mcp/src" "-m" "forj.mcp.server")}

  mcp:install
  {:doc "Install forj-mcp as bbin script"
   :task (shell "bbin" "install" "." "--as" "forj-mcp" "--main-opts" "['-m' 'forj.mcp.server']")}

  eval
  {:doc "Evaluate Clojure code via forj (usage: bb eval '(+ 1 2)' or bb eval -p 1669 '(+ 1 2)')"
   :requires ([forj.mcp.tools :as tools]
              [cheshire.core :as json])
   :task (let [args *command-line-args*
               [port code] (if (= "-p" (first args))
                             [(parse-long (second args)) (nth args 2)]
                             [nil (first args)])
               result (tools/eval-code {:code code :port port})]
           (if (:success result)
             (println (:value result))
             (do (println "Error:" (:error result))
                 (System/exit 1))))}

  nrepl
  {:doc "Start nREPL server for forj development"
   :task (shell "bb" "--nrepl-server" "1669")}}}
